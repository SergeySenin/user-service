# Стандарты модульного тестирования

Единый стиль на базе JUnit 5 и Mockito.

## Общая структура

- Для тестового класса, вложенных классов и методов: `@DisplayName`.
- Для тестов одной функциональной ветки: вложенные классы `@Nested`.
- Тестовые методы по: Arrange-Act-Assert.

## Именование

- Тестовые классы: `<НазваниеКласса>Test`.
- Вложенные классы: `When<Состояние>`/`Given<Предусловие>`.
- Тестовые методы: `should[ОжидаемыйРезультат]When[Состояние]`.

## Инъекция зависимостей и аннотации Mockito
- Для классов с <= 2 зависимостями, потребностью комбинировать: `new`+`@BeforeEach` с моками или реальными объектами.
- Для классов с >= 3 зависимостями, сложной оркестрацией: `@InjectMocks`+`@Mock`.
- Для инициализации `@Mock`, `@Spy`, `@Captor`: `@ExtendWith(MockitoExtension.class)`.

## Тестовые данные
- Однократные значения: локальные переменные инлайном.
- Повторяющиеся значения: константы тестового класса.
- Доменные значения: enum'ы и типизированные категории.
- Связанные значения: record/DTO.
- Типовые сценарии: статические фабричные методы и Object Mother.
- Массивные объекты с вариациями: Test Data Builder.
- Комплексные настройки: методы подготовки окружения.
- Байтовые массивы и потоки: supplier'ы.
- Матрицы сценариев: параметризованные тесты.

## Проверка взаимодействий

- Базовый контроль: `verify(mock).method(...)`.
- Кратность: `verify(mock, times(n))`, отсутствие: `verify(mock, never())`; используются по необходимости.
- Для проверки аргументов: `@Captor` (или `ArgumentCaptor.forClass(...)`).
- Отказ: `verifyNoInteractions(...)`, `verifyNoMoreInteractions(...)`, `verify(mock).method(argThat(...))`, `InOrder`.

## Проверка результатов

- Доступно: `assertEquals`, `assertNotEquals`, `assertTrue`, `assertFalse`, `assertNull`, `assertNotNull`, `assertSame`.
- Для связанных проверок: `assertAll` с заголовком и внутренними сообщениями.
- Исключительные сценарии: `assertThrows` с проверкой типа.
- Для коллекций и массивов: `assertArrayEquals`, `assertIterableEquals`.
- Отказ: `assertDoesNotThrow` и других расширенных приёмов (soft assertions, snapshot-проверок).

## Параметризованные тесты

- Основной вариант: `@ParameterizedTest`+`@MethodSource`.
- Допускается: `@CsvSource` для примитивов и строк без массивных объектов.
- Источники как: `static Stream<Arguments>`.
- Отказ: `@ValueSource`, `@CsvFileSource`.

## Время и идентификаторы

- Продакшн: реальные источники (`Clock.systemUTC()`, `UUID::randomUUID`) через зависимости.
- Тестирование: детерминированные реализации (`Clock.fixed(...)`, заглушки `Supplier<UUID>`); настройка в `@BeforeEach`.

## Стиль и форматирование

- Без: `*` в импортируемых пакетах.
- Полные названия; исключение: общепринятые аббревиатуры.
- При необходимости: `@SuppressWarnings`.
